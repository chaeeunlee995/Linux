

<환경>
운영체제: 리넉스 
가상서버: VMware
공유디스크 사용(iscsi)


1. isci스캔
가상서버에 추가 하고자 하는 디스크 용랑을 할당한 후,
OS에서 인식시키기 위해서는 재스캔 작업이 필요

#특정 LUN이외에도 스캔됨
$ iscsi -m node -R 
#특정 LUN에 한하여 스캔가능(둘다 마운트 상태에서 실행 가능)
$ iscsi -m node --targetname <IQN> -R
or
$ echo 1 > /sys/block/<device명>/device/rescan

#OS상에서 인식되는지 확인
/dev/xxx의 용량이 변했는지 확인
$ fdisk -l 

#다음과 같이 표시되는지 확인
$ parted /dev/sdb(확장대상)

```
GNU Parted 2.1
/dev/xxxを使用
GNU Partedへようこそ！コマンド一覧を見るには'help'と入力してください。
```

#파티션 확장전 용량 확인
$ (parted) p
$ (parted) p free


2. 파티션 확장
OS가 추가된 용량을 인식했으면, 이제부터 할 일은 
확장하고자 하는 용량을 파티션, 물리볼륨, 볼륨그룹, 논리볼륨 순으로 할당하는 것.
먼저 파티션을 새롭게 작성한다.

$ fdisk /dev/xxx
>コマンド(mでヘルプ):p (영역 테이블 표시)
>コマンド(mでヘルプ):n (새롭게 영역을 작성한다)
>コマンド(mでヘルプ):p (영역 테이블 표시)
>コマンド(mでヘルプ):2(사용되고 있지 않은 파티션 번호를 지정한다)

-예) /dev/sdb에 /dev/sdb2를 새롭게 작성하고자 할 떄
  (기존)
  /dev/sdb1
  (변경후)
  /dev/sdb1
  /dev/sdb2
  
#실린더가 시작되는 값 지정
공백으로 두면 자동으로 초기값으로 설정됨
>最小シリンダ(51201－53248、初期値：51201)：
#종료되는 실린더 번호를 지정
공백으로 두면 자동으로 초기값으로 설정됨
>Lase シリンダ,+シリンダ数or +size(K,M,G) (51201-61440, 初期値 61440):

# 새롭게 작성된 영역을 확인
>コマンド(mでヘルプ):p
#시스템 타입을 지정
>コマンド(mでヘルプ):t
#테이블을 디스크에 인식시키고, 종료한다.
>コマンド(mでヘルプ):w
#다음과 같이 표시됨

```
パーティションテーブルは変更されました！

ioctl()を呼び出してパーティションテーブルを再読込みします。

警告：パーティションテーブルの再読込がエラー16で失敗しました：
デバイスもしくはリソースがビジー状態でうｓ。
カーネルはまだ古いテーブルを使っています。新しいテーブルは
次回リブート時か、partprobe(8)またはkpartx(8)を実行した後に
使えるようになるでしょう
ディスクを同期しています。
```

#재부팅, partprobe, kpartx를 실행하야만 디스크가 새롭게 추가된 파티션을 인식한다.
partprobe및 kpartx는 언마운트의 리스크를 배제할 수 없으므로, 
언마운트가 불가하다면 재부팅을 실행을 추천. 
$ shutdown -r now

# fdisk -lu /dev/sdb


3. 파일시스템 확장

#변경 전의 물리볼륨을 확인
$ pvs

#물리볼륨을 새롭게 작성
$ pvcreate /dev/sdb2

#작성한 물리볼륨이 추가 되었는지 확인
$ pvs
$ pvdisplay

#볼륨그룹에 할당하기 전 상태 확인
$ vgs

#볼륨그룹 확장
$ vgextend vgsxx /dev/sdb2

#볼륨그룹 확장되었는지 확인
$ vgs
$ vgdisplay

#확장 전 논리볼륨 확인
$ lvs

#논리볼륨 확장
$ lvextend -l +100%FREE /dev/vgsxx/lvolxxx

#확장 후 논리볼륨 상태 확인
$ lvs
$ lvdisplay

#파일시스템 확장 전 디스크 용량 확인
$ df -h

#파일시스템의 디스크 용량 확장
$ resize2fs /dev/vgsxx/lvolxxx


#확장 후 파일시스템의 디스크 용량 확인
$ df -h
















